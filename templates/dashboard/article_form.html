{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="section auth-section dashboard-form">
  <div class="section-head">
    <h1>{% if article %}Редактирование статьи{% else %}Создание статьи{% endif %}</h1>
    <a href="{% url 'dashboard:article_list' %}" class="button button--secondary">К списку</a>
  </div>

  <form method="post" enctype="multipart/form-data" class="auth-form" novalidate>
    {% csrf_token %}

    {% for field in form %}
      <div class="form-row">
        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field }}
        {% if field.help_text %}<small class="help-text">{{ field.help_text }}</small>{% endif %}
        {% for error in field.errors %}<p class="field-error">{{ error }}</p>{% endfor %}
      </div>
    {% endfor %}

    {% for error in form.non_field_errors %}<p class="field-error">{{ error }}</p>{% endfor %}

    <div class="form-actions">
      <button type="submit" class="button">Сохранить</button>
    </div>
  </form>
</section>

{% if article %}
<section class="section">
  <h2>Дополнительные изображения</h2>

  {% if asset_items %}
    <div class="asset-grid">
      {% for asset in asset_items %}
      <article class="asset-card">
        <img src="{{ asset.file.url }}" alt="{{ asset.caption|default:'Изображение статьи' }}" class="asset-card__image">
        <p class="muted">{{ asset.caption|default:"Без подписи" }}</p>
      </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Дополнительных изображений пока нет.</p>
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="auth-form" novalidate>
    {% csrf_token %}
    <input type="hidden" name="add_asset" value="1">

    {% for field in asset_form %}
      <div class="form-row">
        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field }}
        {% for error in field.errors %}<p class="field-error">{{ error }}</p>{% endfor %}
      </div>
    {% endfor %}

    <button type="submit" class="button">Добавить изображение</button>
  </form>
</section>
{% endif %}
{% endblock %}
