{% extends "base.html" %}

{% block content %}
<section class="section">
  <div class="section-head">
    <h1>Турниры</h1>
    <div class="dashboard-actions">
      <a href="{% url 'dashboard:article_list' %}" class="button button--secondary">Статьи</a>
      <a href="{% url 'dashboard:team_list' %}" class="button button--secondary">Команды</a>
      <a href="{% url 'dashboard:match_list' %}" class="button button--secondary">Матчи</a>
      {% if can_manage_users %}
        <a href="{% url 'dashboard:user_list' %}" class="button button--secondary">Пользователи</a>
      {% endif %}
      <a href="{% url 'dashboard:tournament_create' %}" class="button">Создать турнир</a>
    </div>
  </div>

  {% include "includes/dashboard_search_bar.html" with action_url=request.path query_value=query placeholder="Поиск по названию / городу / дисциплине" aria_label="Поиск турнира" input_aria_label="Поиск турнира" reset_url=reset_url %}

  <form method="get" class="dashboard-actions" style="margin-bottom: 0.75rem;">
    {% if query %}<input type="hidden" name="q" value="{{ query }}">{% endif %}
    <label class="filter-label" for="kind">Тип</label>
    <select class="filter-select" id="kind" name="kind">
      <option value="">Все</option>
      {% for value, label in kind_choices %}
        <option value="{{ value }}" {% if current_filters.kind == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <label class="filter-label" for="discipline">Дисциплина</label>
    <select class="filter-select" id="discipline" name="discipline">
      <option value="">Все</option>
      {% for value, label in discipline_choices %}
        <option value="{{ value }}" {% if current_filters.discipline == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="button button--secondary button--small dash-btn">Фильтр</button>
    <a href="{{ reset_url }}" class="button button--small dash-btn">Сбросить</a>
  </form>

  {% if page_obj.object_list %}
    <div class="dashboard-table-wrap">
      <table class="dashboard-table">
        <thead>
          <tr>
            <th>Название</th>
            <th>Тип</th>
            <th>Дисциплина</th>
            <th>Город</th>
            <th>Статус</th>
            <th>Даты</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for tournament in page_obj.object_list %}
            <tr>
              <td>
                <a href="{% url 'tournaments:tournament_detail' tournament.slug %}" target="_blank" rel="noopener">
                  {{ tournament.name }}
                </a>
                {% if tournament.is_example %}<span class="news-pill">Пример</span>{% endif %}
              </td>
              <td>{{ tournament.get_kind_display }}</td>
              <td>{{ tournament.get_discipline_display|default:"-" }}</td>
              <td>{{ tournament.city|default:"-" }}</td>
              <td>{{ tournament.get_status_display }}</td>
              <td>{{ tournament.start_date|date:"d.m.Y" }} - {{ tournament.end_date|date:"d.m.Y" }}</td>
              <td class="dashboard-actions dash-row-actions">
                <a href="{% url 'dashboard:tournament_edit' tournament.pk %}" class="button button--small dash-btn dash-btn--row dash-btn--edit">Редактировать</a>
                <a href="{% url 'dashboard:tournament_delete' tournament.pk %}" class="button button--small button--danger dash-btn dash-btn--row dash-btn--delete">Удалить</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if page_obj.paginator.num_pages > 1 %}
      <nav class="pagination" aria-label="Пагинация турниров dashboard">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}{% if pagination_query %}&{{ pagination_query }}{% endif %}" class="pagination-link">Назад</a>
        {% endif %}
        <span class="pagination-current">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if pagination_query %}&{{ pagination_query }}{% endif %}" class="pagination-link">Вперед</a>
        {% endif %}
      </nav>
    {% endif %}
  {% else %}
    <p class="muted">Турниры не найдены.</p>
  {% endif %}
</section>
{% endblock %}
