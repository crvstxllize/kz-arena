{% extends "base.html" %}
{% load team_media %}

{% block content %}
<section class="section section-filters" aria-label="Фильтры команд">
  <h1>Команды</h1>
  <p>Составы команд, текущая форма и ключевые показатели.</p>
  {% if is_demo_mode %}
    <div class="message message--warning" role="status">
      Данные команд временно из демо-режима. Добавьте команды в Dashboard, чтобы использовать ручной режим.
    </div>
  {% endif %}
  {% include "includes/data_freshness.html" %}

  <form method="get" class="news-filters">
    <div class="filter-group" role="radiogroup" aria-label="Тип команд">
      <label class="filter-chip {% if not current_filters.kind %}is-active{% endif %}"><input type="radio" name="kind" value="" {% if not current_filters.kind %}checked{% endif %}>Все</label>
      <label class="filter-chip {% if current_filters.kind == 'sport' %}is-active{% endif %}"><input type="radio" name="kind" value="sport" {% if current_filters.kind == 'sport' %}checked{% endif %}>Спорт</label>
      <label class="filter-chip {% if current_filters.kind == 'esport' %}is-active{% endif %}"><input type="radio" name="kind" value="esport" {% if current_filters.kind == 'esport' %}checked{% endif %}>Киберспорт</label>
    </div>

    <div class="filter-group filter-group--selects">
      <div class="filter-field">
        <label class="filter-label" for="discipline">Дисциплина</label>
        <select class="filter-select" id="discipline" name="discipline">
          <option value="">Все</option>
          {% for value, label in discipline_choices %}
            <option value="{{ value }}" {% if current_filters.discipline == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="filter-actions">
        <button type="submit" class="button button--small">Применить</button>
        <a href="{% url 'teams:team_list' %}" class="button button--secondary button--small">Сбросить</a>
      </div>
    </div>
  </form>
</section>

<section class="section">
  {% if page_obj.object_list %}
  <div class="entity-grid">
    {% for team in page_obj.object_list %}
      <article class="entity-card">
        <a href="{% url 'teams:team_detail' team.slug %}" class="entity-card__media-link" aria-label="Открыть страницу команды {{ team.name }}">
          <img src="{{ team|team_logo_url }}" alt="{{ team.name }}" class="entity-card__image" loading="lazy">
        </a>

        <div class="entity-card__body">
          <div class="news-card__meta">
            <span class="news-pill">{{ team.get_kind_display }}</span>
            {% if team.discipline %}<span class="news-pill">{{ team.get_discipline_display }}</span>{% endif %}
            <span>Игроков: {{ team.players.all|length }}</span>
          </div>

          <h3 class="news-card__title"><a href="{% url 'teams:team_detail' team.slug %}">{{ team.name }}</a></h3>
          <p class="news-card__excerpt">{% if team.description %}{{ team.description }}{% else %}Описание пока отсутствует.{% endif %}</p>
          {% if team.source_url %}
            <p class="entity-source"><a href="{{ team.source_url }}" target="_blank" rel="noopener">Источник</a></p>
          {% endif %}
        </div>
      </article>
    {% endfor %}
  </div>

  {% if page_obj.paginator.num_pages > 1 %}
  <nav class="pagination" aria-label="Пагинация команд">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if pagination_query %}&{{ pagination_query }}{% endif %}" class="pagination-link">Назад</a>
    {% endif %}

    <span class="pagination-current">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if pagination_query %}&{{ pagination_query }}{% endif %}" class="pagination-link">Вперед</a>
    {% endif %}
  </nav>
  {% endif %}
  {% else %}
    <p class="muted">Данные отсутствуют.</p>
  {% endif %}
</section>
{% endblock %}
