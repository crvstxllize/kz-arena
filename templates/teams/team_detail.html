{% extends "base.html" %}
{% load team_media %}

{% block content %}
<section class="section team-detail">
  <div class="team-detail__header">
    <div class="team-detail__logo-wrap">
      <img src="{{ team|team_logo_url }}" alt="{{ team.name }}" class="team-detail__logo">
    </div>

    <div>
      <h1>{{ team.name }}</h1>
      <p class="news-card__meta">
        <span class="news-pill">{{ team.get_kind_display }}</span>
        {% if team.discipline %}<span class="news-pill">{{ team.get_discipline_display }}</span>{% endif %}
        <span>{{ team.country }}</span>
      </p>
      <p>{% if team.description %}{{ team.description }}{% else %}Описание пока отсутствует.{% endif %}</p>
    </div>
  </div>
</section>

<section class="section">
  <div class="section-head"><h2 class="section-title">Состав команды</h2></div>
  {% if team.players.all %}
    <div class="team-roster" aria-label="Состав {{ team.name }}">
      {% for player in team.players.all %}
        <article class="team-roster__card">
          <div class="team-roster__photo-wrap">
            <img src="{{ player|player_photo_url }}" alt="{{ player.name }}" class="team-roster__photo" loading="lazy">
          </div>
          <div class="team-roster__body">
            <h3 class="team-roster__name">{{ player.name }}</h3>
            {% if player.position %}
              <p class="team-roster__role">{{ player.position }}</p>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Данные отсутствуют.</p>
  {% endif %}
</section>

<section class="section">
  <div class="section-head"><h2 class="section-title">Ближайшие матчи</h2></div>
  <p class="muted">Матчи: данные из открытых источников/демо.</p>
  {% if upcoming_matches %}
    <div class="match-table-wrap">
      <table class="match-table">
        <thead>
          <tr><th>Дата</th><th>Турнир</th><th>Матч</th><th>Статус</th><th>Счет</th></tr>
        </thead>
        <tbody>
          {% for match in upcoming_matches %}
            <tr>
              <td>{{ match.datetime|date:"d.m.Y H:i" }}</td>
              <td><a href="{% url 'tournaments:tournament_detail' match.tournament.slug %}">{{ match.tournament.name }}</a></td>
              <td><a href="{% url 'matches:match_detail' match.id %}">{{ match.team_a.name }} vs {{ match.team_b.name }}</a></td>
              <td>{{ match.get_status_display }}</td>
              <td>
                {% if match.result %}
                  {{ match.result.score_a }} : {{ match.result.score_b }}
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">Данные отсутствуют.</p>
  {% endif %}
</section>

<section class="section section-all-news">
  <div class="section-head"><h2 class="section-title">Последние статьи по дисциплине</h2></div>
  {% if related_articles %}
    <div class="news-grid news-grid--portal">
      {% for item in related_articles %}
        {% include "includes/news_card.html" with item=item card_variant="compact" %}
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Данные отсутствуют.</p>
  {% endif %}
</section>
{% endblock %}
