{% extends "base.html" %}
{% load team_media %}

{% block content %}
<section class="section team-detail">
  <div class="team-detail__header">
    <div class="team-detail__logo-wrap">
      <img src="{{ team|team_logo_url }}" alt="{{ team.display_name|default:team.name }}" class="team-detail__logo">
    </div>

    <div>
      <h1>{{ team.display_name|default:team.name }}</h1>
      <p class="news-card__meta">
        <span class="news-pill">{{ team.get_kind_display }}</span>
        {% if team.discipline %}<span class="news-pill">{{ team.get_discipline_display }}</span>{% endif %}
        {% if team.is_example %}<span class="news-pill">Пример</span>{% endif %}
        <span>{{ team.country }}</span>
      </p>
      <p>{% if team.description %}{{ team.description }}{% else %}Описание пока отсутствует.{% endif %}</p>
    </div>
  </div>
</section>

<section class="section">
  <div class="section-head"><h2 class="section-title">Состав команды</h2></div>
  {% if team.players.all %}
    <div class="team-roster" aria-label="Состав {{ team.name }}">
      {% for player in team.players.all %}
        <article class="team-roster__card">
          <div class="team-roster__photo-wrap">
            <img src="{{ player|player_photo_url }}" alt="{{ player.name }}" class="team-roster__photo" loading="lazy">
          </div>
          <div class="team-roster__body">
            <h3 class="team-roster__name">{{ player.name }}</h3>
            {% if player.position %}
              <p class="team-roster__role">{{ player.position }}</p>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Данные отсутствуют.</p>
  {% endif %}
</section>

<section class="section">
  <div class="section-head"><h2 class="section-title">Ближайшие матчи</h2></div>
  {% if upcoming_matches %}
    <div class="team-upcoming-matches" aria-label="Ближайшие матчи {{ team.name }}">
      {% for match in upcoming_matches %}
        <article class="team-upcoming-match">
          <div class="team-upcoming-match__date">
            <span class="team-upcoming-match__day">{{ match.start_datetime|date:"d.m" }}</span>
            <span class="team-upcoming-match__time">{{ match.start_datetime|date:"H:i" }}</span>
          </div>

          <div class="team-upcoming-match__body">
            <div class="team-upcoming-match__meta">
              <span class="news-pill">{{ match.get_kind_display }}</span>
              {% if match.discipline %}<span class="news-pill">{{ match.get_discipline_display }}</span>{% endif %}
              <span class="news-pill">{{ match.get_status_display }}</span>
              {% if match.is_example %}<span class="news-pill">Пример</span>{% endif %}
            </div>

            <h3 class="team-upcoming-match__title">
              <a href="{% url 'matches:match_detail' match.id %}">{{ match.participants_display }}</a>
            </h3>

            <p class="team-upcoming-match__details">
              {% if match.tournament %}
                <a href="{% url 'tournaments:tournament_detail' match.tournament.slug %}">{{ match.tournament.name }}</a>
              {% else %}
                Без турнира
              {% endif %}
              {% if match.location_display %}<span>{{ match.location_display }}</span>{% endif %}
            </p>
          </div>

          <div class="team-upcoming-match__side">
            <span class="team-upcoming-match__score">{{ match.score_display|default:"vs" }}</span>
            <a href="{% url 'matches:match_detail' match.id %}" class="button button--secondary button--small">Открыть матч</a>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Матчи пока не добавлены.</p>
  {% endif %}
</section>

<section class="section section-all-news">
  <div class="section-head"><h2 class="section-title">Последние статьи по дисциплине</h2></div>
  {% if related_articles %}
    <div class="news-grid news-grid--portal">
      {% for item in related_articles %}
        {% include "includes/news_card.html" with item=item card_variant="compact" %}
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Данные отсутствуют.</p>
  {% endif %}
</section>
{% endblock %}
